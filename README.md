# –í—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ Go

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –Ω–∞ —è–∑—ã–∫–µ Go —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–æ—Ä—É—Ç–∏–Ω –∏ –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- **–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π**:
  - **Go 1.21** - –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
  - **PostgreSQL** - –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
  - **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
  - **Kafka** - –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
  - **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
  - **Kubernetes** - –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- **HTTP API** —Å RESTful –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
- **Graceful shutdown** –∏ health checks
- **–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ Kubernetes

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:
- Go 1.21+
- Docker –∏ Docker Compose
- Git

### –î–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ Kubernetes:
- Kubernetes –∫–ª–∞—Å—Ç–µ—Ä (minikube, kind, –∏–ª–∏ –æ–±–ª–∞—á–Ω—ã–π)
- kubectl
- Docker registry (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone <repository-url>
cd highload-microservice
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
cp env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` —Ñ–∞–π–ª –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:

```bash
# Server Configuration
SERVER_PORT=8080
SERVER_HOST=0.0.0.0

# Database Configuration
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=highload_db
DB_SSLMODE=disable

# Redis Configuration
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# Kafka Configuration
KAFKA_BROKERS=localhost:9092
KAFKA_TOPIC=user-events
KAFKA_GROUP_ID=highload-service

# Logging
LOG_LEVEL=info
```

### 3. –ó–∞–ø—É—Å–∫ —Å Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ—Å—å —Å—Ç–µ–∫:

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- PostgreSQL –Ω–∞ –ø–æ—Ä—Ç—É 5432
- Redis –Ω–∞ –ø–æ—Ä—Ç—É 6379
- Kafka –Ω–∞ –ø–æ—Ä—Ç—É 9092
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞ –ø–æ—Ä—Ç—É 8080

### 4. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
docker-compose up -d postgres redis kafka

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Go
go mod download

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
go run main.go
```

## üê≥ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Docker –æ–±—Ä–∞–∑–∞

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t highload-microservice:latest .

# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ minikube
eval $(minikube docker-env)
docker build -t highload-microservice:latest .
```

### 2. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ (Docker Desktop Kubernetes)

–ù–∏–∂–µ ‚Äî –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è Docker Desktop Kubernetes (—É–∑–µ–ª `desktop-control-plane`).

1) Namespace –∏ –±–∞–∑–æ–≤—ã–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã:
```bash
kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/secret.yaml -n highload-microservice
kubectl apply -f k8s/configmap.yaml -n highload-microservice
```

2) –ü–æ–¥–Ω—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Postgres, Redis, ZooKeeper, Kafka):
```bash
kubectl apply -f k8s/postgres-deployment.yaml -n highload-microservice
kubectl apply -f k8s/redis-deployment.yaml -n highload-microservice
kubectl apply -f k8s/kafka-deployment.yaml -n highload-microservice
```

3) –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
kubectl get pods -n highload-microservice
kubectl wait --for=condition=ready pod -l app=postgres  -n highload-microservice --timeout=600s
kubectl wait --for=condition=ready pod -l app=redis     -n highload-microservice --timeout=600s
kubectl wait --for=condition=ready pod -l app=zookeeper -n highload-microservice --timeout=900s
kubectl wait --for=condition=ready pod -l app=kafka     -n highload-microservice --timeout=900s
```

4) –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Docker Hub (–Ω–µ–π–º—Å–ø–µ–π—Å –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π, –ø—Ä–∏–º–µ—Ä: `docker.io/oleg2195`):
```bash
docker build -t docker.io/<username>/highload-microservice:latest .
docker login -u <username>   # —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—Ö–æ–¥ –ø–æ Personal Access Token
docker push docker.io/<username>/highload-microservice:latest
```

–í–∞–∂–Ω–æ: –ï—Å–ª–∏ –≤ Docker Desktop –±—ã–ª –≤–∫–ª—é—á—ë–Ω `registry-mirrors`, —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –≤ Settings ‚Üí Docker Engine ("registry-mirrors": []) –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker Desktop.

5) –£–∫–∞–∑–∞—Ç—å –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–µ `k8s/app-deployment.yaml` (–ø–æ–ª–µ `image`):
```yaml
image: docker.io/<username>/highload-microservice:latest
imagePullPolicy: IfNotPresent
```

6) –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
```bash
kubectl apply -f k8s/app-deployment.yaml -n highload-microservice
kubectl rollout restart deployment/highload-microservice -n highload-microservice
kubectl rollout status  deployment/highload-microservice -n highload-microservice
kubectl get pods -n highload-microservice
```

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ namespace
kubectl apply -f k8s/namespace.yaml

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤
kubectl apply -f k8s/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
kubectl get pods -n highload-microservice
kubectl get services -n highload-microservice
```

### 3. –î–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ IP
kubectl get service highload-service -n highload-microservice

# –ò–ª–∏ —á–µ—Ä–µ–∑ port-forward
kubectl port-forward service/highload-service 8080:80 -n highload-microservice
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Kafka, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –¥–æ–±–∞–≤–∏–ª–∏

–í `k8s/kafka-deployment.yaml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ –∏ –ø—Ä–æ–±—ã:
```yaml
- name: KAFKA_LISTENERS
  value: "PLAINTEXT://0.0.0.0:9092"
- name: KAFKA_ADVERTISED_LISTENERS
  value: "PLAINTEXT://kafka-service:9092"
- name: KAFKA_LISTENER_SECURITY_PROTOCOL_MAP
  value: "PLAINTEXT:PLAINTEXT"
```
–ü—Ä–æ–±—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ TCP 9092, —á—Ç–æ –¥–µ–ª–∞–µ—Ç readiness/liveness —Å—Ç–∞–±–∏–ª—å–Ω—ã–º–∏.

–ï—Å–ª–∏ –æ–±—Ä–∞–∑—ã —Ç—è–Ω—É—Ç—Å—è –¥–æ–ª–≥–æ –∏–ª–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è ImagePullBackOff ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ registry mirror –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –≤ Docker Hub; –ø—Ä–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–±–∞–≤—å—Ç–µ `imagePullSecrets` –≤ pod spec.

## üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ë–∞–∑–æ–≤—ã–π URL
- –õ–æ–∫–∞–ª—å–Ω–æ: `http://localhost:8080`
- Kubernetes: `http://<external-ip>`

### Endpoints

#### Health Check
```http
GET /health
```

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

**–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```http
POST /api/v1/users
Content-Type: application/json

{
  "email": "user@example.com",
  "first_name": "John",
  "last_name": "Doe"
}
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```http
GET /api/v1/users/{id}
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```http
PUT /api/v1/users/{id}
Content-Type: application/json

{
  "email": "newemail@example.com",
  "first_name": "Jane"
}
```

**–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```http
DELETE /api/v1/users/{id}
```

**–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
```http
GET /api/v1/users?page=1&limit=10
```

#### –°–æ–±—ã—Ç–∏—è

**–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è:**
```http
POST /api/v1/events
Content-Type: application/json

{
  "user_id": "uuid",
  "type": "user_action",
  "data": "{\"action\": \"login\"}"
}
```

**–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è:**
```http
GET /api/v1/events/{id}
```

**–°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π:**
```http
GET /api/v1/events?page=1&limit=10
```

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **HTTP API** - RESTful –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
2. **User Service** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
3. **Event Service** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kafka
4. **Worker Pool** - –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–æ—Ä—É—Ç–∏–Ω
5. **Database Layer** - —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
6. **Cache Layer** - Redis –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
7. **Message Broker** - Kafka –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Client ‚Üí HTTP API ‚Üí Service Layer ‚Üí Database/Cache
                    ‚Üì
                Kafka Producer ‚Üí Kafka ‚Üí Consumer ‚Üí Worker Pool
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- **–ì–æ—Ä—É—Ç–∏–Ω—ã –∏ –∫–∞–Ω–∞–ª—ã**: Worker pool –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–º –¥–∞–Ω–Ω—ã–º
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å**: Kafka –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
- **Graceful shutdown**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω
- **Health checks**: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞
- **–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: HPA –≤ Kubernetes –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|--------------|
| `SERVER_HOST` | –•–æ—Å—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `0.0.0.0` |
| `SERVER_PORT` | –ü–æ—Ä—Ç –¥–ª—è HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `8080` |
| `DB_HOST` | –•–æ—Å—Ç PostgreSQL | `localhost` |
| `DB_PORT` | –ü–æ—Ä—Ç PostgreSQL | `5432` |
| `DB_USER` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å PostgreSQL | `postgres` |
| `DB_PASSWORD` | –ü–∞—Ä–æ–ª—å PostgreSQL | `postgres` |
| `DB_NAME` | –ò–º—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö | `highload_db` |
| `REDIS_HOST` | –•–æ—Å—Ç Redis | `localhost` |
| `REDIS_PORT` | –ü–æ—Ä—Ç Redis | `6379` |
| `KAFKA_BROKERS` | –ë—Ä–æ–∫–µ—Ä—ã Kafka | `localhost:9092` |
| `LOG_LEVEL` | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è | `info` |

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º logrus
- –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (debug, info, warn, error)
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ —Å–æ–±—ã—Ç–∏—è–º–∏

### Health Checks
- HTTP endpoint `/health` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, Redis –∏ Kafka
- Kubernetes liveness –∏ readiness probes

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ API
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (CPU, –ø–∞–º—è—Ç—å)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Kafka (—Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã/–ø–æ–ª—É—á–µ–Ω—ã)

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- **Connection pooling** –¥–ª—è PostgreSQL
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Redis
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º worker pool
- **Batch –æ–ø–µ—Ä–∞—Ü–∏–∏** –¥–ª—è Kafka
- **–ò–Ω–¥–µ–∫—Å—ã** –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ Kubernetes
- **–ê–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** –Ω–∞ –æ—Å–Ω–æ–≤–µ CPU –∏ –ø–∞–º—è—Ç–∏
- **Load balancing** –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏
- **Graceful shutdown** –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –±–µ–∑ –ø—Ä–æ—Å—Ç–æ—è

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
go test ./...

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
go test -cover ./...

# –ë–µ–Ω—á–º–∞—Ä–∫–∏
go test -bench ./...
```

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ hey (HTTP load testing tool)
go install github.com/rakyll/hey@latest

# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
hey -n 1000 -c 10 -m POST -H "Content-Type: application/json" -d '{"email":"test@example.com","first_name":"Test","last_name":"User"}' http://localhost:8080/api/v1/users

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
hey -n 1000 -c 10 http://localhost:8080/api/v1/users
```

## üß™ E2E –∑–∞–ø—É—Å–∫ (smoke)

### –õ–æ–∫–∞–ª—å–Ω–æ: Docker Compose

```bash
# 1) –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–µ—Å—å —Å—Ç–µ–∫
docker-compose up -d

# 2) –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ —Å–µ—Ä–≤–∏—Å–∞
curl -s -o /dev/null -w '%{http_code}\n' http://localhost:8080/health

# 3) –ó–∞–ø—É—Å—Ç–∏—Ç—å smoke-—Ç–µ—Å—Ç—ã
# Windows PowerShell
./scripts/smoke.ps1
# Linux/macOS
bash scripts/smoke.sh

# 4) –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ
docker-compose down -v
```

### Kubernetes

```bash
# 1) –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)
kubectl apply -f k8s/namespace.yaml
kubectl apply -f k8s/secret.yaml -n highload-microservice
kubectl apply -f k8s/configmap.yaml -n highload-microservice
kubectl apply -f k8s/postgres-deployment.yaml -n highload-microservice
kubectl apply -f k8s/redis-deployment.yaml -n highload-microservice
kubectl apply -f k8s/kafka-deployment.yaml -n highload-microservice
kubectl apply -f k8s/app-deployment.yaml -n highload-microservice

# 2) –î–æ–∂–¥–∞—Ç—å—Å—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
kubectl wait --for=condition=ready pod -l app=highload-microservice -n highload-microservice --timeout=600s

# 3) Port-forward –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å smoke
kubectl port-forward service/highload-service 8080:80 -n highload-microservice &
# Windows PowerShell
./scripts/smoke.ps1
# Linux/macOS
bash scripts/smoke.sh
```

### GitHub Actions

- Compose smoke: `.github/workflows/e2e-compose.yml` (—Å–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞, docker-compose up, smoke)
- K8s smoke (Kind): `.github/workflows/e2e-k8s.yml` (Kind cluster, –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–∞, –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã, smoke)

–ó–∞–ø—É—Å–∫:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ push/pull_request –≤ –≤–µ—Ç–∫—É `main`
- –í—Ä—É—á–Ω—É—é: Actions ‚Üí –≤—ã–±—Ä–∞—Ç—å workflow ‚Üí Run workflow

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—É—à–∞ –≤ –≤–µ—Ç–∫—É main

```bash
# –°–æ–∑–¥–∞—Ç—å/–ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ main –ª–æ–∫–∞–ª—å–Ω–æ
git checkout -B main

# –î–æ–±–∞–≤–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å
git add .
git commit -m "docs: add e2e (compose+k8s) run instructions"

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ origin/main
git push -u origin main
```

## ‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ (—á–µ–∫‚Äë–ª–∏—Å—Ç)

1) –ü–æ–¥—ã –∏ —Å–µ—Ä–≤–∏—Å—ã:
```bash
kubectl get pods -n highload-microservice
kubectl get svc  -n highload-microservice
```

2) API:
```bash
kubectl port-forward service/highload-service 8080:80 -n highload-microservice
curl http://localhost:8080/health
```

3) PostgreSQL:
```bash
kubectl exec -n highload-microservice deploy/postgres -- pg_isready -U postgres
kubectl exec -n highload-microservice deploy/postgres -- psql -U postgres -d highload_db -c "SELECT 1;"
```

4) Redis:
```bash
kubectl exec -n highload-microservice deploy/redis -- redis-cli ping
```

5) Kafka:
```bash
kubectl exec -n highload-microservice deploy/kafka -- kafka-topics --bootstrap-server kafka-service:9092 --list
```

6) –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- POST /api/v1/users ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –æ–Ω –≤ –ë–î.
- GET —Ç–æ–≥–æ –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–≤–∞–∂–¥—ã ‚Äî –≤—Ç–æ—Ä–æ–π —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ (–∫—ç—à Redis).
- POST /api/v1/events ‚Äî —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ, –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–∏—Å–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∞ (worker pool + Kafka consumer).

## üßØ –¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥

- `ImagePullBackOff` —É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Äî –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –æ–±—Ä–∞–∑ –≤ `docker.io/<username>/highload-microservice:latest`, –æ–±–Ω–æ–≤–∏—Ç–µ –ø–æ–ª–µ `image` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ rollout.
- –û—à–∏–±–∫–∏ Kafka –ø—Ä–∏ pull ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç `registry-mirrors` –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω `docker login`. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–±–ª–µ–≥—á—ë–Ω–Ω—É—é Kafka KRaft (—Å–º. –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ `k8s/kafka-deployment.yaml`).
- –¢–∞–π–º–∞—É—Ç—ã `context deadline exceeded` —É –∫–æ–Ω—Å—é–º–µ—Ä–∞ ‚Äî –Ω–æ—Ä–º–∞–ª—å–Ω—ã –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ç–æ–ø–∏–∫–µ.

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ä—ã
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- **SQL injection protection** —á–µ—Ä–µ–∑ prepared statements
- **Non-root –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- **Secrets management** –≤ Kubernetes
- **Rate limiting** —á–µ—Ä–µ–∑ Ingress

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ HTTPS/TLS
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (JWT, OAuth2)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã
- **Prometheus** + **Grafana** –¥–ª—è –º–µ—Ç—Ä–∏–∫
- **ELK Stack** (Elasticsearch, Logstash, Kibana) –¥–ª—è –ª–æ–≥–æ–≤
- **Jaeger** –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
- **AlertManager** –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- RPS (Requests Per Second)
- Latency (P50, P95, P99)
- Error rate
- Resource utilization (CPU, Memory)
- Database connection pool status
- Kafka lag

## ü§ù –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
.
‚îú‚îÄ‚îÄ cmd/                    # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/               # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–∞–∫–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ config/            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/          # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ kafka/             # Kafka –∫–ª–∏–µ–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ models/            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ redis/             # Redis –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ worker/            # Worker pool
‚îú‚îÄ‚îÄ k8s/                   # Kubernetes –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –°–æ–≥–ª–∞—à–µ–Ω–∏—è
- **–ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ**: camelCase –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, PascalCase –¥–ª—è —Ç–∏–ø–æ–≤
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏ –ª–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –∏—Å–ø–æ–ª—å–∑—É–µ–º context.Context –¥–ª—è –æ—Ç–º–µ–Ω—ã –æ–ø–µ—Ä–∞—Ü–∏–π
- **–ì–æ—Ä—É—Ç–∏–Ω—ã**: –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º WaitGroup –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- **–†–µ—Å—É—Ä—Å—ã**: –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Ä–µ—Å—É—Ä—Å—ã (defer)



